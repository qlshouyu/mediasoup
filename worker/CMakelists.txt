cmake_minimum_required(VERSION 3.5)

# set(CMAKE_CXX_STANDARD c++17)
set(SOURCE 
  src/lib.cpp
  src/DepLibSRTP.cpp
  src/DepLibUV.cpp
  src/DepLibWebRTC.cpp
  src/DepOpenSSL.cpp
  src/DepUsrSCTP.cpp
  src/Logger.cpp
  src/MediaSoupErrors.cpp
  src/Settings.cpp
  src/Worker.cpp
  src/ChannelMessageRegistrator.cpp
  src/Utils/Crypto.cpp
  src/Utils/File.cpp
  src/Utils/IP.cpp
  src/Utils/String.cpp
  src/handles/SignalHandle.cpp
  src/handles/TcpConnectionHandle.cpp
  src/handles/TcpServerHandle.cpp
  src/handles/TimerHandle.cpp
  src/handles/UdpSocketHandle.cpp
  src/handles/UnixStreamSocketHandle.cpp
  src/Channel/ChannelNotifier.cpp
  src/Channel/ChannelRequest.cpp
  src/Channel/ChannelNotification.cpp
  src/Channel/ChannelSocket.cpp
  src/RTC/ActiveSpeakerObserver.cpp
  src/RTC/AudioLevelObserver.cpp
  src/RTC/Consumer.cpp
  src/RTC/DataConsumer.cpp
  src/RTC/DataProducer.cpp
  src/RTC/DirectTransport.cpp
  src/RTC/DtlsTransport.cpp
  src/RTC/IceCandidate.cpp
  src/RTC/IceServer.cpp
  src/RTC/KeyFrameRequestManager.cpp
  src/RTC/NackGenerator.cpp
  src/RTC/PipeConsumer.cpp
  src/RTC/PipeTransport.cpp
  src/RTC/PlainTransport.cpp
  src/RTC/PortManager.cpp
  src/RTC/Producer.cpp
  src/RTC/RateCalculator.cpp
  src/RTC/Router.cpp
  src/RTC/RtcLogger.cpp
  src/RTC/RtpListener.cpp
  src/RTC/RtpObserver.cpp
  src/RTC/RtpPacket.cpp
  src/RTC/RtpProbationGenerator.cpp
  src/RTC/RtpRetransmissionBuffer.cpp
  src/RTC/RtpStream.cpp
  src/RTC/RtpStreamRecv.cpp
  src/RTC/RtpStreamSend.cpp
  src/RTC/RtxStream.cpp
  src/RTC/SctpAssociation.cpp
  src/RTC/SctpListener.cpp
  src/RTC/SenderBandwidthEstimator.cpp
  src/RTC/SeqManager.cpp
  src/RTC/Shared.cpp
  src/RTC/SimpleConsumer.cpp
  src/RTC/SimulcastConsumer.cpp
  src/RTC/SrtpSession.cpp
  src/RTC/StunPacket.cpp
  src/RTC/SvcConsumer.cpp
  src/RTC/TcpConnection.cpp
  src/RTC/TcpServer.cpp
  src/RTC/Transport.cpp
  src/RTC/TransportCongestionControlClient.cpp
  src/RTC/TransportCongestionControlServer.cpp
  src/RTC/TransportTuple.cpp
  src/RTC/TrendCalculator.cpp
  src/RTC/UdpSocket.cpp
  src/RTC/WebRtcServer.cpp
  src/RTC/WebRtcTransport.cpp
  src/RTC/Codecs/H264.cpp
  src/RTC/Codecs/H264_SVC.cpp
  src/RTC/Codecs/VP8.cpp
  src/RTC/Codecs/VP9.cpp
  src/RTC/Codecs/Opus.cpp
  src/RTC/RtpDictionaries/Parameters.cpp
  src/RTC/RtpDictionaries/RtcpFeedback.cpp
  src/RTC/RtpDictionaries/RtcpParameters.cpp
  src/RTC/RtpDictionaries/RtpCodecMimeType.cpp
  src/RTC/RtpDictionaries/RtpCodecParameters.cpp
  src/RTC/RtpDictionaries/RtpEncodingParameters.cpp
  src/RTC/RtpDictionaries/RtpHeaderExtensionParameters.cpp
  src/RTC/RtpDictionaries/RtpHeaderExtensionUri.cpp
  src/RTC/RtpDictionaries/RtpParameters.cpp
  src/RTC/RtpDictionaries/RtpRtxParameters.cpp
  src/RTC/SctpDictionaries/SctpStreamParameters.cpp
  src/RTC/RTCP/Packet.cpp
  src/RTC/RTCP/CompoundPacket.cpp
  src/RTC/RTCP/SenderReport.cpp
  src/RTC/RTCP/ReceiverReport.cpp
  src/RTC/RTCP/Sdes.cpp
  src/RTC/RTCP/Bye.cpp
  src/RTC/RTCP/Feedback.cpp
  src/RTC/RTCP/FeedbackPs.cpp
  src/RTC/RTCP/FeedbackRtp.cpp
  src/RTC/RTCP/FeedbackRtpNack.cpp
  src/RTC/RTCP/FeedbackRtpTmmb.cpp
  src/RTC/RTCP/FeedbackRtpSrReq.cpp
  src/RTC/RTCP/FeedbackRtpTllei.cpp
  src/RTC/RTCP/FeedbackRtpEcn.cpp
  src/RTC/RTCP/FeedbackRtpTransport.cpp
  src/RTC/RTCP/FeedbackPsPli.cpp
  src/RTC/RTCP/FeedbackPsSli.cpp
  src/RTC/RTCP/FeedbackPsRpsi.cpp
  src/RTC/RTCP/FeedbackPsFir.cpp
  src/RTC/RTCP/FeedbackPsTst.cpp
  src/RTC/RTCP/FeedbackPsVbcm.cpp
  src/RTC/RTCP/FeedbackPsLei.cpp
  src/RTC/RTCP/FeedbackPsAfb.cpp
  src/RTC/RTCP/FeedbackPsRemb.cpp
  src/RTC/RTCP/XR.cpp
  src/RTC/RTCP/XrDelaySinceLastRr.cpp
  src/RTC/RTCP/XrReceiverReferenceTime.cpp
)

include_directories(include)

add_subdirectory(deps/libwebrtc)
add_subdirectory(fbs)

add_subdirectory(subprojects/abseil-cpp-20220623.0)
add_subdirectory(subprojects/Catch2-2.13.7)
add_subdirectory(subprojects/flatbuffers-23.3.3)
add_subdirectory(subprojects/libsrtp-2.5.0)
add_subdirectory(subprojects/libuv-v1.44.2)
add_subdirectory(subprojects/openssl-3.0.8)
add_subdirectory(subprojects/usrsctp-4e06feb01cadcd127d119486b98a4bd3d64aa1e7)
add_subdirectory(subprojects/wingetopt-1.00)


add_library(mediasoup-worker SHARED ${SOURCE})
add_library(mediasoup-worker_a STATIC ${SOURCE})